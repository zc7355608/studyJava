# Git

------

- ### Git是什么：

  > git是目前世界上最先进的，免费、开源的**分布式版本控制工具**，就是管理软件开发项目中的源代码等文件的，一个软件。不只是源码，还有人力资源、代码资源、文档资源等文件都可以用git来管理。而管理这些文件资源的软件我们称为**SCM软件**，SCM软件（软件配置管理）是指：通过执行**版本控制**来保证团队协作场景下，文件的一致性和完整性的软件。

  - ##### 何为版本控制：

    > 所谓版本控制就是：记录文件修改的历史记录，从而能让用户通过查看历史版本，方便版本切换或文件回溯操作。

  - ##### 为什么需要版本控制：

    > 对于个人来说，版本控制可以方便我们随时查看，什么时间点，对文件修改了哪些内容；对于团队来说，可以识别不同开发者所开发的具体内容，追踪每一个开发者的行为，从而可以协作开发，提高团队协作效率。所以版本控制可以对我们工作成果进行保护，它是团队协作开发时必不可少的功能。
    >
    > **冲突**：当团队中不同开发者对同一个文件的同一处做了修改时，提交时就会发生冲突。此时要及时沟通，商讨如何处理。

  - ##### 版本控制工具应该具备的基础功能：

    > 1. 保存和管理文件。在文件修改时自动给文件加上“版本号”，用于不同版本的同一个文件的区分和备份。当文件改动时，通过提交命令为此次的修改加上“版本号”，方便后续的管理。
    > 2. 提供不同版本的文件的对比功能。如果文件修改并提交为了一个新的版本，那么此时需要对比记录2个版本的区别，此次到底修改了哪些地方。（注意：word、图片、压缩包等特殊格式的文件它是无法比对出修改了哪些内容的，比对只能比对出普通的文本文件）
    > 3. 对工作区内容的监控。当工作区目录中的文件发生了变化，能够及时知道哪些文件变动了。

- ### Git的特点：（目前几乎都是用Git）

  > git是由linux之父林纳斯团队开发的，特点是：简单、体积小、多分支速度快、分布式、有能力高效率地管理超大规模项目。

- ### Git的安装：

  > 全部下一步即可。成功后右键出现两个选项`git GUI`（git提供的图形工具）和`git Bash`（进行版本控制的命令行工具）
  >
  > 安装时虽然可以指定主分支的名字，但是不建议改，主分支就叫`master`

------

### （了解内容）

> 版本控制工具从实现模式上可以分为2种：
>
> - **集中式版本控制工具（CVS/SVN/VSS）**：版本库集中放在内网或外网的中央服务器上，所有的用户都要通过客户端软件，连入内/外网将文件资源下载到本地进行操作，操作完成再将文件上传，由中央资源库对所有文件进行统一的版本控制。缺点是同一时刻只能有一个用户进行项目的上传，并且如果中央服务器出问题了所有东西都没了，安全隐患很大。所以这个现在没人用了，我们都用分布式版本控制工具git，出了中央库之外，每个成员电脑上还维护着一个本地版本库。
>
> - **分布式版本控制工具**：Git就是分布式版本控制系统，可以没有中央服务器，每个成员的电脑本地都是一个完整的版本库。这种方式没网也可以用，原理是通过复制整个代码仓库到每个成员电脑本地，每个开发者都可以在本地进行版本控制和修改。当需要同步代码时，开发者通过推送（push）和拉取（pull）操作，与其他开发者的本地库进行merge合并。
>
>   这种分布式结构使得团队成员可以更加独立地工作，减少了对中央服务器的依赖，提高了代码的安全性和灵活性。

------

- ### Git版本控制命令的使用：（后面我们都是用其他的图形化工具来完成，所以会用即可）

  > git版本控制功能是通过，在安装的git Bash工具中，输入git命令（大多数linux命令都可以使用）来实现的。我们看下如何用git命令完成文件资源的版本控制：

  - **设置用户签名**：在使用git进行团队协作开发时，不同的人对文件做了修改，版本库会记录该文件的版本号以及修改者的签名。而这个签名就是，用户使用本地git库时，所使用的签名。所以要求操作之前，首先要设置该git库中的用户签名和用户的邮箱。

    > 设置用户签名：`git config --global user.name "用户名"`（如果有特殊符号就加双引号）
    >
    > 设置用户邮箱：`git config --global user.email 邮箱`
    >
    > 查看全局配置：`git config --list`
    >
    > （`--global`表示本地所有git库的用户签名和邮箱都是这个）（也可以通过修改配置文件`C:\Users\22737\.gitconfig`）

  - **初始化本地git版本库**：我们希望git帮我们管理哪个目录下的文件，就将该目录初始化为git版本库，然后就可以在该目录下打开git Bash工具，执行git命令就可以完成版本控制了。（目录可以不为空，但是注意目录名不要出现空字符和中文）

    > 初始化git库命令：`git init`，注意必须是在当前目录下执行。此时会出现`.git`隐藏目录，这就是本地版本库了。

  - **查看版本库的状态**：`git status`，可以查看当前用户所在的分支，分支下的提交历史、待提交的文件。

  - **git本地操作的3个区域**：

    1. 工作区（Working Directory）：在git管理的目录下，也就是本地版本库中，对文件进行增/删/改/查，此时都是在工作区。
    2. 暂存区：当对文件完成修改后，可以将文件提交到暂存区。git会对暂存区中的文件进行比对，将修改的地方记录。
    3. 本地仓库/版本库（Git Repository）：暂存区的文件提交后，就真正成为了版本库中的一个版本，也就真正对版本库做了修改，会形成一个版本号。如果发生错误就可以进行版本回溯，将版本库中的文件还原到该版本的状态。并且团队其他人也可以从版本库中获取该版本的版本库。（在本地版本库中有此次修改对应的40位16进制的版本号`commitId`，这个版本号可以用来定位文件，前2位是目录名，后面是文件名）

    > - **将工作区修改的内容提交到暂存区**：`git add 文件名`（多个文件以空格隔开），`git add .`添加所有修改，1.x版本的git要用`git add -A`，可以将暂存区的文件放回到工作区：`git rm --cached 文件名`
    >
    > - **暂存区内容提交到本地仓库**：`git commit -m "该版本的备注信息" 文件名`（通常我们不加文件名，将暂存区修改的所有文件都提交）

  - **查看版本库中所有分支的版本信息**：`git reflog`，信息以栈结构输出，命令后面可以加其他参数来控制输出内容。另一个命令`git log`默认是查看当前分支的版本信息，而且不包括已经被删除的提交和版本回退之后的提交。

  - **版本回退**：`git reset --hard 版本号`，版本号就是`commmitId`，可以不用写全，但至少要写前4位。一般只会查看版本信息而不会使用版本回退的功能，容易引发冲突，所以知道即可。

------

### 文件忽略：

> - Git对于版本库中的某些大文件（如安装包等），是会自动忽略不会管理的。如果我们想自定义，让git忽略某些文件，可以在版本库目录下，新建`.gitignore`文件，里面写忽略规则（#是注释），这些规则对当前目录以及所有子目录生效。
>
> - 常见规则：
>
>   - `/目录名/`，表示忽略掉该目录
>   - `*.zip`，表示忽略掉所有文件名以`.zip`结尾的文件
>   - `/目录名/a.jpg`，表示忽略某个具体文件
>   - `!a.jpg`，表示不忽略某个文件
>
> - 但是我们作为Java开发者，一般像`.class`文件、`.tar`文件，或者idea项目中的`.iml`文件、`.idea`文件等，这些文件几乎永远不用被git版本库所管理，因为它不是我们写的源代码，对项目运行没有任何影响。所以这些忽略规则我们每次初始化版本库，都需要创建`.gitignore`文件然后手动加上这些忽略规则。因此我们写一个忽略文件`git.gitignore`放在与`.gitconfig`同级的目录`C:\Users\22737`下，然后`.gitconfig`中的`[core]`下设置忽略文件的位置：
>
>   ```ini
>   [core]
>   	excludesfile = C:/Users/22737/git.gitignore
>   ```
>
>   `git.gitignore`中：（这样以后就不需要每次初始化版本库都创建一个忽略文件了，忽略的文件写在这里即可）
>
>   ```ini
>   # Compiled class file
>   *.class
>   
>   # Log file
>   *.log
>   
>   # BlueJ files
>   *.ctxt
>   
>   # Mobile Tools for Java (J2ME)
>   .mtj.tmp/
>   
>   # Package Files #
>   *.jar
>   *.war
>   *.nar
>   *.ear
>   *.zip
>   *.tar.gz
>   *.rar
>   
>   # virtual machine crash logs, see http://www.java.com/en/download/help/error_hotspot.xml
>   hs_err_pid*
>   # 以下是新加的内容
>   .classpath
>   .project
>   .settings
>   target
>   .idea
>   *.iml
>   ```

------

- ### 图形化工具Git Hub Desktop的使用：

  > 实际的开发中我们不会使用命令行来进行版本控制，一般都是通过友好的图形化工具。Git官方推荐的图形化工具是GitHub提供的GitHub Desktop工具，使用它可以方便快捷的管理本地版本库。双击安装即可。我们看下如何用：

  1. 首先打开后，可以选择从远程克隆一个仓库，或在本地创建一个仓库，或导入本地已有仓库。（可以有多个仓库）
  2. 然后我们可以看到左侧的仓库、内容的变化、以及提交的版本历史记录。中间菜单可以查看和选择当前分支，菜单上还有发布/推送按钮，可以将本地库推送/发布到远程仓库上，前提是你登陆了GitHub远程仓库的账号。（Gitee账号不行，本地创建的仓库只能发布到GitHub上）

- ### IDEA中使用Git：

  > 我们如果让git帮我们管理源代码，那么用idea完成代码编写后，还需要找到idea的源代码文件，然后初始化为git本地库，将里面的内容进行提交保存到本地版本库中，有点麻烦。
  >
  > 其实IDEA中也提供了git客户端工具的功能，直接通过IDEA中的插件就可以完成源代码的版本控制和拉取/提交操作（相应的其他开发工具如VS Code中也有对应的git插件）。所以日常的源代码我们不需要用命令行git Bash，也不需要Git Hub Desktop客户端工具。我们看下怎么在IDEA中使用git：

  1. 首先需要在IDEA中安装3个插件：Gitee、Git、GitHub，有了这3个插件我们才能使用Git工具以及连接到远程版本库。
  2. 有了这3个插件后，我们再设置git：Settings -> Version Control中，来设置Git工具的位置，以及GitHub、Gitee的账号。
  3. 然后就可以通过IDEA菜单栏中的VCS（Version Control System版本控制系统）来将项目目录初始化为一个Git版本库目录了。
  4. 由于我们是新建的项目文件，再进行的初始化，所以这些文件都需要右键git，Add添加到暂存区准备提交。红色的是修改后未移交暂存区的，绿色的是在暂存区未提交的。提交点击commit，选择要提交的文件填写版本信息提交即可（文件颜色恢复正常）。
  5. 最后再将本地版本库分享到远程GitHub或Gitee上，远程GitHub仓库就会创建一个相同的版本库。

------



```txt
        -没有提交到本地仓库的删除操作可以通过命令直接恢复【git restore 文件名】

    * 版本回退：当我们删了某个东西并提交到了本地仓库，如果想找回来，就得用版本回退功能；版本回退分两步：
        1、查看当前分支上的时间点【git log [option]】，log后可以加参数：
            -【--all】显示所有分支
            -【--pretty=oneline】显示为一行
            -【--abbrev-commit】更简短的输出
            -【--graph】以图的形式输出
        （【git log 时间点】表示只查看这个时间点之前的提交操作）
        2、回退；【git reset --hard 版本号】（commit id可以不用写全，但至少要写前4位）
        （注意：版本回退成功会丢失之后的时间点，此时如果还想返回到回退之前的时刻，怎么办呢？还是要拿到对应时间点的“commit id”，可以通过【git reflog】
            拿到最新的“commit id”，然后再进行“版本回退”操作即可）

    * 如果我们就想将删除的文件恢复，还想不丢失时间点，就需要使用“还原”【git revert 版本号】，注意：这里的“版本号id”是指，还原到该时间点的提交操作之前；
        它等同于将该时间点之前的操作，又进行了提交，所以东西就回来了；

------------------------------------------------------
# Git的分布式管理：
    * 原理：团队中多个成员使用Git版本控制系统时，可以在本地创建多个分支/版本库来同时开展不同的工作。每个分支都是独立的工作路径，可以在不影响其他分支
        的情况下进行修改和提交。当你创建一个新分支时，Git会在当前的代码基础上复制一个新的分支，然后你可以在新分支上进行修改，而原始分支保持不变。
        这种方式可以让团队成员在不互相干扰的情况下并行开发不同的功能或修复bug。一旦在分支上的工作完成，可以将最终版“合并”回主分支或其他分支，
        从而实现代码的整合。Git的分支管理使得团队协作更加灵活高效。

    * 分支：之前我们每次提交后都会有一个记录，每条记录有修改时间、用户、修改内容注释等信息，Git将这一串记录串成“时间线”，形成类似时间轴的东西，
        这个时间轴就是一个分支，我们叫它“主分支master branch”；（注意github上叫“main分支”）
        在开发时往往是团队协作，因此一个主分支是不够的，git鼓励开发者使用多个分支完成开发任务，这些分支之间互不影响，会更加安全；

    * 分支相关指令：（注意：git目录中，在某个分支下的更改记录或痕迹，如果切换了分支，那么之前更改的都会消失，因为分支间的操作互不影响）
        -创建分支【git branch 分支名】，创建分支实际上就是给版本库创建副本了，不同的分支下，虽然是同一个文件目录中，内容却是不同的；
            注意它必须在有提交操作之后才能使用，也就是仓库中得有东西；
        -查看所有分支【git branch】，当前分支前面是“*”且是绿色；
        -切换分支【git checkout 分支名】；也可以创建并切换分支【git checkout -b 分支名】，记得切换分支前一定要提交，提交就不会丢；
        -删除分支【git branch -d 分支名】；注意删除前请确保该分支的操作进行了合并，否则会删除失败；【-D】参数是强制删除；
        -合并分支【git merge 被合并到当前分支的分支名】，如果合并出现冲突，那么git会自动将冲突信息写入到发生冲突的文件中，
            此时我们根据提示的信息去找该冲突文件，将冲突文件里的内容处理然后提交即可；

# 标签：每次提交对应的id太长不好记，我们可以给某个提交的commit id起个别名【git tag 标签别名 提交id】，查看所有的标签别名用【git tag】，
    此时就可以用它来代替“commit id”来操作；删除标签【git tag 标签别名】；这个标签别名也可以用来提示我们这个提交做了什么；
    【git tag -d 标签名】删除标签；
    其实标签别名还可以用来创建新的分支branch，分支就是引用了一个版本号commit id，分支本质就是给这个版本号加了别名，例如【git checkout -b 标签别名】

------------------------------------------------------
# git远程操作：我们git应该有一个远程的中央仓库，这样可以让不同区域的人员进行同一个项目的协作开发，这里我们用gitHub；
    * 首先在github上创建仓库，相当于本地操作中的init初始化git仓库了；public的就行，名字最好和项目名保持一致；这就是远程的中央仓库了，它类似于master分支，
        此时在不同电脑上将github上的仓库克隆下来就相当于创建了不同的分支（虽然在本地看来自己还是master主分支）；这个本地版本库和远程版本库基本一模一样；

    * 此时本地仓库的config文件中就有远程仓库的地址，里面的remote后面的名称"origin"表示下面的远程仓库url的名字，地址可以是https的也可以是ssh的；
        没有的话就是本地仓库，可以直接在文件中更改关联到远程仓库，也可以用bash命令【git remote add 远程仓库名 地址】增加；
        【git remote】查看远程仓库名字；
        【git remote rename】修改远程仓库名字；

    * 从远程版本库克隆/提交项目的两种常规的方式：
        -基于http协议：首先使用【git clone url 文件名】指令将线上仓库克隆到本地，此时本地仓库就建好了（url从github上https拿），如果没有文件名那么默认
        和远程仓库保持一致，然后就可以对该git目录进行操作了：
            1、提交缓存区；2、提交本地仓库；这两步命令和上面一样；
            3、提交线上仓库【git push [-f] [--set-upstream] [远程仓库名] [本地分支名:远程分支名]】；
                省略的话默认使用config中的唯一remote值，这里就是origin的url；-f表示如果冲突了就以本地为准强行覆盖，
                --set-upstream是第一次推送的时候，确定本地分支和远端分支的对应关系；
                首次往线上仓库提交内容时会出现403，因为不是任何人都能往线上仓库提交的，需要授权；按照提示操作即可；
            4、拉取线上仓库：【git pull 远程仓库名 本地分支名:远程分支名】，将远程仓库上的修改操作同步到本地；
            5、本地仓库发布到gitHub：【git publish 远程仓库名 本地分支名:远程分支名】
            6、从远程仓库抓取【git fetch [远程仓库名] [远程分支名]】，就是将远程所有更新抓取到本地，但不合并，默认抓取所有分支，git pull就是它的合并版；
            （一般都是对本地的master分支进行推送和拉取操作的）

        -基于ssh协议：这种方式和上面一样，只是用户身份认证方式不同而已；（推荐使用）
            SSH是安全外壳协议（Secure Shell）的缩写，由IETF小组制定，它是专门为远程登录会话和其他网络服务提供安全性的协议，目前比较可靠，可以有效防止
            传输过程中的信息泄露；推荐使用基于密钥的验证方式，所以你必须为自己创建一对密钥，然后将“私钥”放在本地，公钥放在需要通过SSH访问的服务器上；
            1、首先在gitbash中用指令生成“公私钥对”文件【ssh-keygen -t rsa -C "github注册的邮箱"】；然后连续回车即可；
                这个指令要执行必须先有OpenSSH，windows设置里添加可选功能即可；
            2、将公钥上传到GitHub【id_rsa.pub】的设置中；标题随意如【zcbook】；此时就可以用git指令来将线上版本库克隆到本地进行使用了，方式和上面一样；
    （以后记得上班先pull，下班就push）

# 线上上传冲突：如果我们一开始忘了git pull，导致上传出现了冲突没有上传成功，那么此时可以选择【git pull】将冲突合并到文件中，我们根据提示打开本地冲突文件，
    根据情况更改本地文件后再【git push】上传即可；
    （这个和本地多分支进行合并时出现的冲突类似，也是通过将冲突信息添加到本地文件中，然后根据需要进行修改，然后重新合并即可）

---------其他---------------------------------------------
# git本地仓库中可以在objects目录根据“提交号”找文件，但这个文件打不开只能用git bash命令查看【git cat-file -p 提交id】（-p参数表示友好地查看）
    * 我们发现，该文件其实是当前的“提交信息”文件，里面还有指向另一个文件的commit id，根据这个id我们找到本次提交对应的文件的“状态信息”；
        “状态信息”文件还指向第三个文件的commit id，根据这个id我们继续找，第三个文件才是“文件内容”；
    * 每一次的“提交信息”文件都指向了上一次的提交信息文件；它们之间是线性连接的
    * 我们的这些提交信息文件哪个是最新的呢，在本地仓库的“HEAD文件”中有【main】文件，它指向了当前main分支最新的“提交信息”文件；
        当我们切换分支对应【HEAD】文件就指向其他分支文件，不同分支可以指向相同的“提交信息”文件；
    * 我们切换分支时，git会自动去仓库中将我们该分支对应的文件提出来；
    * git会在本地仓库和工作区（git目录）之间的缓存区里面，对我们的修改进行比对（除了忽略的），【git add】就是添加到比对区（缓存区）让git进行比对操作的，
        比对完成的进行【git commit】之后就提交到了本地仓库，相当于进行了一次修改操作；
----------------------------------------
# 我们之前都是使用第三方的代码托管平台如gitHub，能不能自己搭建一个平台呢？虽然用git也可以搭建远程版本库，但是功能单一、操作不人性化，所以这里介绍GitLab的用法：
    * 简介：GitLab（极狐）是一个用于仓库管理系统的开源项目，使用Git作为代码管理工具，并在此基础上搭建起来的web服务。它是使用MIT许可证的基于网络的Git仓库管理工具，
        且具有wiki和issue跟踪功能。GitLab由乌克兰程序员DmitriyZaporozhets和ValerySizov开发，是Ruby语言写的，后来一些部分用Go语言重写。截止2018年5月，
        该公司约有290名团队成员，以及2000多名开源贡献者。
        GitLab被IBM，Sony，JülichResearchCenter，NASA，Alibaba，Invincea，O’ReillyMedia，Leibniz-Rechenzentrum(LRZ)，CERN，SpaceX等组织使用。
    * 它是运行在linux系统上的
```

