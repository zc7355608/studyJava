# Git

------

- ### Git是什么：

  > git是目前世界上最先进的，免费、开源的**分布式版本控制工具**，就是管理软件开发项目中的源代码等文件的，一个软件。不只是源码，还有人力资源、代码资源、文档资源等文件都可以用git来管理。而管理这些文件资源的软件我们称为**SCM软件**，SCM软件（软件配置管理）是指：通过执行**版本控制**来保证团队协作场景下，文件的一致性和完整性的软件。

  - ##### 何为版本控制：

    > 所谓版本控制就是：记录文件修改的历史记录，从而能让用户通过查看历史版本，方便版本切换或文件回溯操作。

  - ##### 为什么需要版本控制：

    > 对于个人来说，版本控制可以方便我们随时查看，什么时间点，对文件修改了哪些内容；对于团队来说，可以识别不同开发者所开发的具体内容，追踪每一个开发者的行为，从而可以协作开发，提高团队协作效率。所以版本控制可以对我们工作成果进行保护，它是团队协作开发时必不可少的功能。
    >
    > **冲突**：当团队中不同开发者对同一个文件的同一处做了修改时，提交时就会发生冲突。此时要及时沟通，商讨如何处理。

  - ##### 版本控制工具应该具备的基础功能：

    > 1. 对版本库中的内容进行监控。当版本库目录中的文件发生了变化，能够及时知道哪些文件变动了。
    > 2. 保存和管理文件。在文件修改时自动给文件加上“版本号”，用于不同版本的同一个文件的区分和备份。当文件改动时，通过提交命令为此次的修改加上“版本号”，方便后续的管理。
    > 3. 提供不同版本的文件的对比功能。如果文件修改并提交为了一个新的版本，那么此时需要对比记录2个版本的区别，此次到底修改了哪些地方。（注意：docx、图片、压缩包等特殊格式的文件它是无法比对出修改了哪些内容的，比对只能比对出普通的文本文件）

- ### Git的特点：（目前几乎都是用Git）

  > git是由linux之父林纳斯团队开发的，特点是：简单、体积小、多分支速度快、分布式、有能力高效率地管理超大规模项目。

- ### Git的安装：

  > 全部下一步即可。成功后右键出现两个选项`git GUI`（git提供的图形工具）和`git Bash`（进行版本控制的命令行工具）
  >
  > 安装时虽然可以指定主分支的名字，但是不建议改，主分支就叫`master`

------

### （了解内容）

> 版本控制工具从实现模式上可以分为2种：
>
> - **集中式版本控制工具（CVS/SVN/VSS）**：版本库集中放在内网或外网的中央服务器上，所有的用户都要通过客户端软件，连入内/外网将文件资源下载到本地进行操作，操作完成再将文件上传，由中央资源库对所有文件进行统一的版本控制。缺点是同一时刻只能有一个用户进行项目的上传，并且如果中央服务器出问题了所有东西都没了，安全隐患很大。所以这个现在没人用了，我们都用分布式版本控制工具git，出了中央库之外，每个成员电脑上还维护着一个本地版本库。
>
> - **分布式版本控制工具**：Git就是分布式版本控制系统，可以没有中央服务器，每个成员的电脑本地都是一个完整的版本库。这种方式没网也可以用，原理是通过复制整个代码仓库到每个成员电脑本地，每个开发者都可以在本地进行版本控制和修改。当需要同步代码时，开发者通过推送（push）和拉取（pull）操作，与其他开发者的本地库进行merge合并。
>
>   这种分布式结构使得团队成员可以更加独立地工作，减少了对中央服务器的依赖，提高了代码的安全性和灵活性。

------

- ### Git版本控制命令的使用：（后面我们都是用其他的图形化工具来完成，所以会用即可）

  > git版本控制功能是通过，在安装的git Bash工具中，输入git命令（大多数linux命令都可以使用）来实现的。我们看下如何用git命令完成文件资源的版本控制：

  - **设置用户签名**：在使用git进行团队协作开发时，不同的人对文件做了修改，版本库会记录该文件的版本号以及修改者的签名。而这个签名就是，用户使用本地git库时，所使用的签名。所以要求操作之前，首先要设置该git库中的用户签名和用户的邮箱。

    > 设置用户签名：`git config --global user.name "用户名"`（如果有特殊符号就加双引号）
    >
    > 设置用户邮箱：`git config --global user.email 邮箱`
    >
    > 查看全局配置：`git config --list`
    >
    > （`--global`表示本地所有git库的用户签名和邮箱都是这个）（也可以通过修改配置文件`C:\Users\22737\.gitconfig`）

  - **初始化本地git版本库**：我们希望git帮我们管理哪个目录下的文件，就将该目录初始化为git版本库，然后就可以在该目录下打开git Bash工具，执行git命令就可以完成版本控制了。（目录可以不为空，但是注意目录名不要出现空字符和中文）

    > 初始化git库命令：`git init`，注意必须是在当前目录下执行。此时会出现`.git`隐藏目录，这就是本地版本库了。

  - **查看版本库的状态**：`git status`，可以查看当前用户所在的分支，分支下的提交历史、待提交的文件。

  - **git本地操作的3个区域**：

    1. 工作区（Working Directory）：在git管理的目录下，也就是本地版本库中，对文件进行增/删/改/查，此时都是在工作区。git会自动检测工作区中的变化。
    2. 暂存区：当对某个文件修改后，可以将该文件先提交到暂存区，等所有修改都完毕放在了暂存区后，再将本次的修改进行统一的提交，提交到版本库中形成一个版本号，也就是做一次修改。
    3. 本地仓库/版本库（Git Repository）：当本次将所有文件都修改完毕放在暂存区后，就可以对暂存区中的本次修改进行提交，形成一次真正的修改，此次修改就真正成为了版本库中记录的一个版本，且会形成一个40位16进制的版本号`commitId`。如果发生错误就可以进行版本回溯，将版本库中的文件还原到该版本的状态。并且团队其他人也可以从版本库中获取该版本的版本库。

    > - **将工作区修改的内容提交到暂存区**：`git add 文件名`（多个文件以空格隔开），`git add .`添加所有修改，1.x版本的git要用`git add -A`，可以将暂存区的文件放回到工作区：`git rm --cached 文件名`
    >
    > - **暂存区内容提交到本地仓库**：`git commit -m "该版本的备注信息" 文件名`（通常我们不加文件名，将暂存区修改的所有文件都提交）

  - **查看版本库中所有分支的版本信息**：`git reflog`，信息以栈结构输出，命令后面可以加其他参数来控制输出内容。另一个命令`git log`默认是查看当前分支的版本信息，而且不包括已经被删除的提交和版本回退之后的提交。

  - **版本回退**：`git reset --hard 版本号`，版本号就是`commmitId`，可以不用写全，但至少要写前4位。一般只会查看版本信息而不会使用版本回退的功能，容易引发冲突，所以知道即可。
  
    > 版本回退还有一个命令：`git revert 版本号`。和reset不同的是，它是将之前版本的文件内容进行了新的提交。
  
  - **文件还原**：`git restore 文件名`，还原工作区中的文件到最新提交时的状态。它会将版本库工作区中对文件的修改，还原到最新提交时的状态，暂存区中未提交的修改都丢弃。还原全部文件：`git restore .`

------

### 文件忽略：

> - Git对于版本库中的某些大文件（如安装包等），是会自动忽略不会管理的。如果我们想自定义，让git忽略某些文件，可以在版本库目录下，新建`.gitignore`文件，里面写忽略规则（#是注释），这些规则对当前目录以及所有子目录生效。
>
> - 常见规则：
>
>   - `/目录名/`，表示忽略掉该目录
>   - `*.zip`，表示忽略掉所有文件名以`.zip`结尾的文件
>   - `/目录名/a.jpg`，表示忽略某个具体文件
>   - `!a.jpg`，表示不忽略某个文件
>
> - 但是我们作为Java开发者，一般像`.class`文件、`.tar`文件，或者idea项目中的`.iml`文件、`.idea`文件等，这些文件几乎永远不用被git版本库所管理，因为它不是我们写的源代码，对项目运行没有任何影响。所以这些忽略规则我们每次初始化版本库，都需要创建`.gitignore`文件然后手动加上这些忽略规则。因此我们写一个忽略文件`git.gitignore`放在与`.gitconfig`同级的目录`C:\Users\22737`下，然后`.gitconfig`中的`[core]`下设置忽略文件的位置：
>
>   ```ini
>   [core]
>   	excludesfile = C:/Users/22737/git.gitignore
>   ```
>
>   `git.gitignore`中：（这样以后就不需要每次初始化版本库都创建一个忽略文件了，忽略的文件写在这里即可）
>
>   ```ini
>   # Compiled class file
>   *.class
>         
>   # Log file
>   *.log
>         
>   # BlueJ files
>   *.ctxt
>         
>   # Mobile Tools for Java (J2ME)
>   .mtj.tmp/
>         
>   # Package Files #
>   *.jar
>   *.war
>   *.nar
>   *.ear
>   *.zip
>   *.tar.gz
>   *.rar
>         
>   # virtual machine crash logs, see http://www.java.com/en/download/help/error_hotspot.xml
>   hs_err_pid*
>   # 以下是新加的内容
>   .classpath
>   .project
>   .settings
>   target
>   .idea
>   *.iml
>   ```

------

- ### Git的分支管理：

  > - Git版本库中可以有多个分支，每个分支交给不同的成员用于记录它自己的提交。每个分支只维护它自己的版本号，最终开发完成时合并分支（版本合并）即可。
  >
  > - 分支：分支就是一串提交记录，一个分支上记录着一个开发者每次的提交记录。
  >
  > - 如果是单人开发，那么只有一个master主分支即可（github上叫main分支），因为只有你一个人会进行提交修改版本库，所以主分支上记录着你一个人的提交记录就够了。
  >
  > - 但是我们往往是团队协作开发，当团队中多个成员使用Git时，每个人都向同一个远程版本库的同一个分支（主分支master）上进行提交，很容易发生冲突。因为在第一个成员提交后，版本库主分支的版本就发生了变化，此时后续的`push`提交操作都会被拒绝，必须先将最新的版本库变更`pull`拉取到本地，和本地没有冲突后才能继续`push`上传，而且上传可能还会发生冲突。这样开发效率太低了，因此在团队开发中，只有一个主分支是不够的。
  >
  > - 我们可以在版本库中创建多个分支。当创建一个新分支时，Git会在当前分支的基础上复制一个新的分支，然后你就可以在新分支上进行修改，提交到新分支的内容不会影响原始分支。这种方式可以让团队成员在互不干扰的情况下并行开发不同的功能。一旦某人在某个分支上的工作完成，就可以将最终版合并到主分支上，从而实现代码的整合。因此Git的分支管理可以使团队协作更加灵活高效。

- ### Git分支管理的命令：

  - **创建分支**：`git branch 分支名`，就是以当前分支的当前版本为副本，创建了一个新的分支。
  - **查看所有分支**：`git branch`
  - **切换分支**：`git checkout 分支名`，注意：切换分支时会把工作区和暂存区的内容都带过去，因为工作区和暂存区是公共的，所有分支共享。
  - **合并分支**：`git merge 被合并到当前分支的分支名`，如果合并出现冲突，那么git会自动将冲突信息写入到发生冲突的文件中，此时我们根据提示的信息去找该冲突文件，将冲突文件里的内容处理然后提交即可。
  - **删除分支**：`git branch -d 分支名`，注意：删除分支前请确保该分支的所有提交合并到了主分支，否则会删除失败。加`-D`参数可以强制删除。


------

- ### Git多个版本库之间协作开发：

  > 我们自己的本地仓库往往是从其他远程或本地库通过url地址（基于HTTPS协议或SSH协议）拷贝过来的副本，而这就需要用命令来设置本地库所关联的远程库的地址（也可以在版本库下的`.git/config`文件中设置某个分支默认关联的远程库的url）。
  
  > SSH协议（推荐）：SSH是安全外壳协议（Secure Shell）的缩写，由IETF小组制定，是专门为远程登录会话和其他网络服务提供安全性的协议，目前比较可靠，可以有效防止传输过程中的信息泄露。推荐使用基于密钥的SSH验证方式，所以使用必须先为自己创建一对密钥，然后将“私钥”放在本地，公钥放在需要通过SSH访问的服务器上。具体用法：
  >
  > 1. 在Git Bash中用指令生成“公私钥对”文件：`ssh-keygen -t rsa -C "github注册的邮箱"`，然后连续回车即可。（执行这个命令必须有OpenSSH程序，在windows设置里添加可选功能即可）
  >2. 将本地生成的公钥上传到GitHub上。查看本地的公钥文件：`cat ~/.ssh/id_rsa.pub`，然后将内容复制到GitHub的SSH公钥设中，标题随意如`zcbook`。此时本地库和线上库就可以用SSH协议通信了。

  - 添加一个远程仓库：`git remote add 远程仓库别名 地址`
  - 修改远程仓库别名：`git remote rename 旧别名 新别名`
  - 查看所有远程仓库：`git remote`

  > 将远程仓库设置好后，我们就可以直接通过仓库别名的方式将远程库克隆到本地了。
  >
  > 克隆远程库到本地：`git clone url 远程库的文件名`，不指定文件名默认克隆整个库。
  >
  > （无法直接将本地库上传到远程，因为上传需要url，而url需要远程先有这个仓库。客户端工具可以做到）

  - 提取远程仓库的更新：
    - 方式1：`git fetch 远程仓库别名 远程分支名`，该命令会去远程仓库的分支上下载最新的提交历史，但不会自动合并这些更改到本地分支，只是下载到本地并存储在本地仓库中的远程跟踪分支中。如果需要更新本地当前分支需要：`git merge 远程分支名`，将远程分支合并到当前分支。这样才真正完成了提取远程仓库并更新本地分支。
    - 方式2：`git pull 远程仓库别名 本地分支名:远程分支名`，它是方式1的简化，直接用远程仓库的分支来更新本地分支。
  - 推送本地更新到远程：`git push 远程仓库别名 本地分支名:远程分支名`，省略的话就是config中，当前分支配置的默认远程仓库。

------

- ### 图形化工具Git Hub Desktop的使用：

  > 实际的开发中我们不会使用命令行来进行版本控制，一般都是通过友好的图形化工具。Git官方推荐的图形化工具是GitHub提供的GitHub Desktop工具，使用它可以方便快捷的管理本地版本库。双击安装即可。我们看下如何用：

  1. 首先打开后，可以选择从远程克隆一个仓库，或在本地创建一个仓库，或导入本地已有仓库。（可以有多个仓库）
  2. 然后我们可以看到左侧的仓库、内容的变化、以及提交的版本历史记录。中间菜单可以查看和选择当前分支，菜单上还有发布/推送按钮，可以将本地库推送/发布到远程仓库上，前提是你登陆了GitHub远程仓库的账号。（Gitee账号不行，本地创建的仓库只能发布到GitHub上）

- ### IDEA中使用Git：

  > 我们如果让git帮我们管理源代码，那么用idea完成代码编写后，还需要找到idea的源代码文件，然后初始化为git本地库，将里面的内容进行提交保存到本地版本库中，有点麻烦。
  >
  > 其实IDEA中也提供了git客户端工具的功能，直接通过IDEA中的插件就可以完成源代码的版本控制和拉取/提交操作（相应的其他开发工具如VS Code中也有对应的git插件）。所以日常的源代码我们不需要用命令行git Bash，也不需要Git Hub Desktop客户端工具。我们看下怎么在IDEA中使用git：

  1. 首先需要在IDEA中安装3个插件：Gitee、Git、GitHub，有了这3个插件我们才能使用Git工具以及连接到远程版本库。
  2. 有了这3个插件后，我们再设置git：Settings -> Version Control中，来设置Git工具的位置，以及GitHub、Gitee的账号。
  3. 然后就可以通过IDEA菜单栏中的VCS（Version Control System版本控制系统）来将项目目录初始化为一个Git版本库目录了。
  4. 由于我们是新建的项目文件，再进行的初始化，所以这些文件都需要右键git，Add添加到暂存区准备提交。红色的是修改后未移交暂存区的，绿色的是在暂存区未提交的。提交点击commit，选择要提交的文件填写版本信息提交即可（文件颜色恢复正常）。
  5. 最后再将本地版本库分享到远程GitHub或Gitee上，远程GitHub仓库就会创建一个相同的版本库。

------

- ### Git标签：

  > - 如果你达到一个重要的阶段，并希望永远记住这个特殊的提交时刻，此时可以使用`git tag 标签内容`给最新的一次提交打上标签。也可以指定给某个提交添加标签：`git tag -a 标签内容 提交id`
  > - 查看所有标签：`git tag`
  > - `git tag -a 标签内容`加-a参数可以创建一个带注解的标签，它会记录标签是谁何时创建的。所以推荐使用带注解的标签。
  > - 标签可以当作本次提交的别名使用，用它来代替提交id。并且标签还可以用来分支名，分支本质上就是给提交id加了别名。
  > - 删除标签：`git tag -d 标签名`

------



```txt
---------其他---------------------------------------------
# git本地仓库中可以在objects目录根据“提交号”找文件，但这个文件打不开只能用git bash命令查看【git cat-file -p 提交id】（-p参数表示友好地查看）
    * 我们发现，该文件其实是当前的“提交信息”文件，里面还有指向另一个文件的commit id，根据这个id我们找到本次提交对应的文件的“状态信息”；
        “状态信息”文件还指向第三个文件的commit id，根据这个id我们继续找，第三个文件才是“文件内容”；
    * 每一次的“提交信息”文件都指向了上一次的提交信息文件；它们之间是线性连接的
    * 我们的这些提交信息文件哪个是最新的呢，在本地仓库的“HEAD文件”中有【main】文件，它指向了当前main分支最新的“提交信息”文件；
        当我们切换分支对应【HEAD】文件就指向其他分支文件，不同分支可以指向相同的“提交信息”文件；
    * 我们切换分支时，git会自动去仓库中将我们该分支对应的文件提出来；
    * git会在本地仓库和工作区（git目录）之间的缓存区里面，对我们的修改进行比对（除了忽略的），【git add】就是添加到比对区（缓存区）让git进行比对操作的，
        比对完成的进行【git commit】之后就提交到了本地仓库，相当于进行了一次修改操作；
----------------------------------------
# 我们之前都是使用第三方的代码托管平台如gitHub，能不能自己搭建一个平台呢？虽然用git也可以搭建远程版本库，但是功能单一、操作不人性化，所以这里介绍GitLab的用法：
    * 简介：GitLab（极狐）是一个用于仓库管理系统的开源项目，使用Git作为代码管理工具，并在此基础上搭建起来的web服务。它是使用MIT许可证的基于网络的Git仓库管理工具，
        且具有wiki和issue跟踪功能。GitLab由乌克兰程序员DmitriyZaporozhets和ValerySizov开发，是Ruby语言写的，后来一些部分用Go语言重写。截止2018年5月，
        该公司约有290名团队成员，以及2000多名开源贡献者。
        GitLab被IBM，Sony，JülichResearchCenter，NASA，Alibaba，Invincea，O’ReillyMedia，Leibniz-Rechenzentrum(LRZ)，CERN，SpaceX等组织使用。
    * 它是运行在linux系统上的
```

